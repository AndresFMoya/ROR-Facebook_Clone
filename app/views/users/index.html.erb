<div>
  <% @users.each do |user| %>
    <ul>
      <span><%= link_to user.name, user %></span>
      <% if !current_user.friends.include?(user) %>
        <span>
          <%= form_with(model: Friendship, method: :post) do |f| %>
            <%= f.submit 'Request Friend', class: "btn btn-primary" %>
            <%= f.hidden_field :confirmed, value: false %>
            <%= f.hidden_field :user_id, value: current_user.id %>
            <%= f.hidden_field :friend_id, value: user.id %>
          <% end %>
        </span>
      <% elsif friend_requests.include?(user) %>
        <span>Friend Requested!</span>
      <% elsif pending_friends.include?(user) %>
        <%= form_with(model: Friendship, method: :patch) do |f| %>
          <%= f.submit 'Accept Friend', class: "btn btn-primary" %>
          <%= f.hidden_field :confirmed, value: true %>
          <%= f.hidden_field :user_id, value: current_user.id %>
          <%= f.hidden_field :friend_id, value: user.id %>
        <% end %>
      <% end %>
    </ul>
  <% end %>
</div>